// TODO: Controls / Indicators
// TODO: Transition Types/Styles.
// TODO: More API / Event listeners (maybe instead of callbacks).
var console=console?console:{log:function(){return null}};(function(t){t.fn.PanelCarousel=function(e){function n(){f.element.is_playing=!0;f.element.addClass("is-playing").removeClass("is-paused");t.data(f.element,"state","playing");f.timer||(f.timer=setTimeout(i,a.panel_duration));f.element.playPauseButton&&f.element.playPauseButton.toggleState()}function r(){f.element.is_playing=!1;clearTimeout(f.timer);f.element.addClass("is-paused").removeClass("is-playing");t.data(f.element,"state","paused");f.element.playPauseButton&&f.element.playPauseButton.toggleState()}function i(){var e=f.element.current_panel+1;e===f.element.panels.length&&(e=0);o(e)}function s(){var e=f.element.current_panel-1;e<0&&(e=f.element.panels.length-1);o(e)}function o(e){clearTimeout(f.timer);if(e>-1&&e<f.element.panels.length){var n=f.element.current_panel;f.element.panels[n].stop(!0).change("fadeout");f.element.panels[e].stop(!0).change("fadein");f.element.indicators&&f.element.indicators.setActiveItem(e);f.element.current_panel=e}t.data(f.element,"state")==="playing"&&(f.timer=setTimeout(i,a.panel_duration))}function u(){t.data(f.element,"state","paused");f.element.playPauseButton&&f.element.playPauseButton.toggleState();a.loopCancelled()}var a=t.extend({stylesheet:"/css/panelcarousel.css",panel_css_selector:".panel",start_loop_on_init:!0,carousel_loops:!0,show_indicators:!0,show_previous_next:!0,show_play_pause:!0,cancel_loop_on_indicator_click:!0,cancel_loop_on_button_click:!0,transition:null,transition_duration:1e3,panel_duration:8e3,beforeShow:function(){},afterShow:function(){},beforeAnimation:function(){},afterAnimation:function(){},beforeHide:function(){},afterHide:function(){},indicatorClick:function(){},controlClick:function(){},loopCancelled:function(){}},e),f={_initDom:function(){f._initStyles();f._initPanels();a.show_indicators===!0&&f._initIndicators();a.show_play_pause===!0&&f._initPlayPause();a.show_previous_next===!0&&f._initPreviousNext()},_initStyles:function(){var e=t("#panel-carousel-stylesheet");if(e.length===0){e=t('<link rel="stylesheet" id="panel-carousel-stylesheet" href="'+a.stylesheet+'" type="text/css">').appendTo("head");document.createStyleSheet&&document.createStyleSheet(a.stylesheet)}f.css=e},_initPanels:function(){f.element.panels.each(function(n,r){var i=t(r);i.change=function(e){var t={fadeout:0,fadein:1};if(typeof t[e]=="undefined")return!1;(function(){if(n!==f.element.current_panel){if(a.beforeShow(i,n))return!1;i.css({opacity:0,display:"block",zIndex:1});if(a.afterShow(i,n)===!1)return!1}else i.css({zIndex:0});if(a.beforeAnimation(i,n)===!1)return!1})();i.animate({opacity:t[e]},a.transition_duration,"linear",function(){if(n!==f.element.current_panel){if(a.beforeHide(i,n)===!1)return!1;i.css("display","none");if(a.afterHide(i,n)===!1)return!1}if(a.afterAnimation===!1)return!1})};if(f.element.current_panel!==n){i.css({opacity:0,display:"none"});i.is_showing=!1}f.element.panels[n]=i})},_initIndicators:function(){f.element.indicators=t('<ul class="panel-carousel-indicators"></ul>');f.element.indicators.items=[];f.element.indicators.setActiveItem=function(e){if(e!==f.element.current_panel){f.element.indicators.items[e].addClass("active");f.element.indicators.items[f.element.current_panel].removeClass("active")}};f.element.panels.each(function(n,r){var i=r.attr("title")?r.attr("title"):"Panel "+(n+1),s=t('<li class="panel-carousel-indicator-item indicator-item-'+n+'"></li>'),l=t('<a href="#'+i+'" title="'+i+'">'+i+"</a>").on("click",function(t){a.cancel_loop_on_indicator_click&&u();t.preventDefault();a.indicatorClick(s,n,r);o(n)});f.element.current_panel===n&&s.addClass("active");s.append(l);f.element.indicators.append(s);f.element.indicators.items.push(s)});f.element.append(f.element.indicators)},_initPlayPause:function(){var e={playing:{text:"Pause",cssClass:"panel-carousel-pause-btn"},paused:{text:"Play",cssClass:"panel-carousel-play-btn"}},i=e[t.data(f.element,"state")].text,s=e[t.data(f.element,"state")].cssClass;f.element.playPauseButton=t('<a href="#'+i+'" title="'+i+'" class="panel-carousel-play-pause-toggle '+s+'">'+i+"</a>").on("click",function(i){i.preventDefault();a.controlClick(f.element.playPauseButton);t.data(f.element,"state")==="playing"?r():n()});f.element.playPauseButton.toggleState=function(n){var r=n||t.data(f.element,"state"),i=e[r].text,s=e[r].cssClass;f.element.playPauseButton.attr("href","#"+i).attr("title",i).attr("class","panel-carousel-play-pause-toggle "+s).text(i)};if(a.attach_play_pause_to_indicators){var o=t('<li class="panel-carousel-control-item play-pause-control"></li>');o.append(f.element.playPauseButton);f.element.indicators.append(o)}else f.element.append(f.element.playPauseButton)},_initPreviousNext:function(){f.element.previousButton=t('<a href="#Previous" title="Previous" class="panel-carousel-previous-button">Previous</a>').on("click",function(t){a.cancel_loop_on_button_click&&u();t.preventDefault();a.controlClick(f.element.previousButton);s()});f.element.nextButton=t('<a href="#Next" title="Next" class="panel-carousel-next-button">Next</a>').on("click",function(t){a.cancel_loop_on_button_click&&u();t.preventDefault();a.controlClick(f.element.nextButton);i()});f.element.append(f.element.previousButton).append(f.element.nextButton)},_initApi:function(){f.element.play=function(){n()};f.element.start=function(){n()};f.element.pause=function(){r()};f.element.stop=function(){r()};f.element.nextPanel=function(){i()};f.element.gotoNext=function(){i()};f.element.previousPanel=function(){s()};f.element.gotoPrevious=function(){s()};f.element.gotoPanel=function(e){o(e)}}};return this.each(function(){f.element=t(this);t.data(f.element,"state","paused");f.element.addClass("panel-carousel");f.element.current_panel=0;f.element.panels=f.element.children(a.panel_css_selector);if(f.element.panels.length<2)return!1;f._initDom();f._initApi();if(a.start_loop_on_init){n();t.data(f.element,"state","playing")}return f.element})}})(jQuery);